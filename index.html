<!doctype html>
<html lang="en">

	<head>
		<meta charset="utf-8">

		<title>MIG (Mozilla InvestiGator)</title>

		<meta name="description" content="A framework for easily creating beautiful presentations using HTML">
		<meta name="author" content="Hakim El Hattab">

		<meta name="apple-mobile-web-app-capable" content="yes" />
		<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />

		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">

		<link rel="stylesheet" href="css/reveal.css">
		<link rel="stylesheet" href="css/theme/mig.css" id="theme">

		<!-- Code syntax highlighting -->
		<link rel="stylesheet" href="lib/css/zenburn.css">

		<!--[if lt IE 9]>
		<script src="lib/js/html5shiv.js"></script>
		<![endif]-->
	</head>

	<body>

		<div class="reveal">

			<!-- Any section element inside of this container is displayed as a slide -->
			<div class="slides">
				<section>
                    <h1><span style="color: #CC5600;">MIG</span><br /><span style="color: #CC5600;">M</span>ozilla <span style="color: #CC5600;">I</span>nvesti<span style="color: #CC5600;">G</span>ator</h1>
                    <img src="statics/mig-logo-transparent.png" width="70%"/>
					<h3>Distributed and Real-Time Digital Forensics at the Speed of the Cloud</h3>
					<p>
						<small><a href="https://jve.linuxwall.info">Julien Vehent</a> / <a href="http://twitter.com/jvehent">@jvehent</a></small>
					</p>
				</section>

                <section>
                    <h2><span style="color: #CC5600;">Julien Vehent</span>, <a href="https://wiki.mozilla.org/Security/OpSec">Operations Security</a></h2>
                    <p>
                        <table>
                            <tr>
                                <td>
                                    <ul>
                                        <li>we respond to security investigations and incidents</li>
                                        <li>we help developers design and implement security controls</li>
                                        <li>we build tools &amp; services to keep Mozilla secure</li>
                                    </ul>
                                </td><td>
                                    <img src="statics/OpSec.png" width="100%"/>
                                </td>
                            </tr>
                        </table>
                    </p>
                </section>

                <section>
                    <h2>That unfortunate commit...</h2>
                    <span class="fragment">
                        <p>git commit -a . &amp;&amp; git push github master</p>
                    </span>
                    <span class="fragment">
                        <img src="statics/githubfail.png" width="100%"/>
                    </span>
                    <span class="fragment">
                        <img src="statics/fail.png" width="30%"/>
                    </span>
                    <span class="fragment">
                        <p>$ mig file -path / -name "^\.boto$" -content "key_sample" -size "&lt;1k" -maxdepth 5</p>
                    </span>
                    
                </section>

				<section>
					<h2>We're building a better Internet</h2>
                    <p>
                        <img src="statics/firefox_logo-only_RGB.png" width="30%"/>
                        <img src="statics/hack.png" width="30%"/>
                        <img src="statics/firefox-os-logo.png" width="30%"/>
                    </p>
				</section>

				<section>
					<h2>Strong startup/incubator mindset</h2>
                    <p>
                        <ul>
                            <li>Experiment &amp; fail fast</li>
                            <li>Minimalistic centralization</li>
                            <li>Everyone can write and host a website...</li>
                            <li>...sometimes using operational standards</li>
                        </ul>
                    </p>
				</section>

                <section>
                    <h2>Security at the perimeter doesn't work when your infrastructure lives all over the internet</h2>
                    <ul>
                        <li>400+ active websites &amp; services</li>
                        <li>a dozen offices, hundreds of remotees</li>
                        <li>2 datacenters, tons of AWS accounts, heroku, rackspace, ...</li>
                    </ul>
                    <p>all loosely connected only when needed</p>
                </section>

				<section>
                    <h2>Incident Response at Mozilla</h2>
                    <p><img src="statics/haystack.jpg" width="80%" /></p>
				</section>

                <section>
                    <h2>Need for a strong<br />Operations Security group</h2>
                    <p><img src="statics/opsec_venn.png" width="60%" /></p>
                </section>

				<section>
					<h2>3 OpSec problems</h2>
					<table>
					    <tr>
                            <td><span style="color: #CC5600;">Visibility</span></td><td>too many systems doing too many things in too many ways. Need to see them all.</td>
                        </tr>
					    <tr>
                            <td><span style="color: #CC5600;">Reachability</span></td><td>we don't have accounts or network accesses to all systems.</td>
                        </tr>
					    <tr>
                            <td><span style="color: #CC5600;">Heterogeneity</span></td><td>every <em>snowflake</em> system is investigated in its own special way.</td>
                        </tr>
                    </table>
                    </ol>
				</section>

				<section>
					<h2>99% of investigations are simple</h2>
                    <p align="left">- "Hey Systems, seen that <span style="color: #427ac6;">&lt;file|ip|process|user&gt;</span> lately?".<br />
                    - "Nope"<br />
                    - "Nope"<br />
                    - "Nope"<br />
                    - "Oh yeah, just yesterday!" <span style="color: #CC5600;">    &lt;--- OMG DEFCON 1!!!</span>
					</p>
				</section>

				<section>
                    <h2>The faster we run investigations,<br />the more we will investigate.</h2>
                    <ul>
                        <li>bob left the company, did we revoke all his accesses?</li>
                        <li>massive libstuff1 vulnerability, is it used anywhere?</li>
                        <li>found IP 13.37.66.66 brute forcing the VPN, check other nodes to see if it's connected</li>
                        <li>jean-kevin put some AWS key on pastebin, is it configured anywhere?</li>
                        <li>anyone remembers that weird host that was running an anonymous proxy?</li>
                    </ul>
                </section>

                <section>
                    <h2>We couldn't find a tool we liked,<br />so we built one</h2>
                    <img src="statics/mig-logo-transparent.png" width="90%"/>
                </section>

                <section>
                    <h2>Demos!</h2>
                    <img src="statics/foxhunt.gif" width="200%"/>
                </section>

                <section>
                    <h2>Locating a cron job that contains a password</h2>
                    <video width="150%" controls>
                        <source data-src="statics/cronjob_demo.webm" type="video/webm" />
                    </video>
                </section>

                <section>
                    <h2>Basic investigation workflow</h2>
                    <img src="statics/MIG_investigation_workflow.svg" />
                </section>

                <section>
                    <h2>Got any private keys in those home folders?</h2>
                    <video width="150%" controls>
                        <source data-src="statics/privatekey_demo.webm" type="video/webm" />
                    </video>
                </section>

                <section>
                    <h2>Is that botnet IP connected anywhere?</h2>
                    <video width="150%" controls>
                        <source data-src="statics/netstat_ip_demo.webm" type="video/webm" />
                    </video>
                </section>

                <section>
                    <h2>Scan processes memories for a regex</h2>
                    <video width="150%" controls>
                        <source data-src="statics/memory_nginx_demo.webm" type="video/webm" />
                    </video>
                </section>

                <section>
                    <h2>Digital forensics on steroids</h2>
                    <span class="fragment">
                        <p>Massively <span style="color: #CC5600;">Distributed</span> means Fast.</p>
                    </span>
                    <span class="fragment">
                        <p>Simple to deploy and <span style="color: #CC5600;">Cross-Platform</span>.</p>
                    </span>
                    <span class="fragment">
                        <p><span style="color: #CC5600;">Secure!</span> Don't trust until you verify.</p>
                    </span>
                    <span class="fragment">
                        <p>Don't spook on data, respect <span style="color: #CC5600;">Privacy</span>.</p>
                    </span>
                </section>

                <section>
                    <h2>Massively distributed</h2>
                    <p>Central platform only passes messages around.<br />Investigation &amp; computation is done on the agents.</p>
                    <p>Small infrastructure footprint<br />means easier to deploy and operate.</p>
                </section>

                <section>
                    <h2>Simple to deploy</h2>
                    <p>One static binary, no dependencies.<br />Configuration is built-in or deployed via provisioning.</p>
                    <img src="statics/gophercolor.png" width="80%"/>
                </section>

                <section>
                    <h2>As secure as PGP, so pretty good</h2>
                    <pre><code data-trim>
{
  "name": "locate bad actor",
  "target": "mode='daemon'",
  "validfrom": "2015-05-27T00:29:29.038012Z",
  "expireafter": "2015-05-27T00:30:59.038012Z",
  "operations": [
    { "module": "file",
      "parameters": {
        "searches": { "s1": { "paths":      ["/etc/cron.d"],
                              "contents":   ["badpassword"]
    }}}}
  ],
  "pgpsignatures": ["wsBcBAABCAAQBQJVZRAlCRCj1lIXO3..."],
  "syntaxversion": 2
}
                    </code></pre>
                </section>

                <section>
                    <h2>Privacy: I used to be a spy...</h2>
                    <table>
                        <tr>
                            <td tyle="vertical-align:middle">
                                <p>Doing forensics without full access to all data is hard, but not impossible.</p>
                                <p>Agents do the work and return answers without raw data.</p>
                            </td>
                            <td>
                                <img src="statics/burnnotice.jpg" width="100%"/>
                            </td>
                        </tr>
                    </table>
                </section>

                <section>
                    <h2>Internals</h2>
                    <p>REST API receives signed JSON messages<br />
                    distributed to agents via RabbitMQ<br />
                    and stored in a Postgres database.
                    </p>
                </section>

                <section>
                    <img src="statics/MIG-Arch-Diagram.png" width="80%"/>
                </section>

                <section>
                    <h2>Architecture of the Agent</h2>
                    <pre>
             +-------+   [ - - - - - - A G E N T - - - - - - - - - - - - ]
             |command|+----&gt;(listener)
             +-------+          |(2)
               ^                V
               |(1)         (parser)
               |               +       [ m o d u l e s ]
+---------+    |            (3)|----------&gt; op1 +----------------+
|SCHEDULER|+---+               |------------&gt; op2 +--------------|
|         |<---+               |--------------&gt; op3 +------------|
+---------+    |               +----------------&gt; op4 +----------+
               |                                                 V(4)
               |(6)                                         (receiver)
               |                                                 |
               |                                                 V(5)
               +                                             (publisher)
             +-------+                                           /
             |results|&lt;-----------------------------------------
             +-------+
                    </pre>
                </section>

                <section>
                    <h2>Security of the Agent</h2>
                    <p>Agent only runs something if these conditions are met:<p>
                    <p><ul>
                        <li>action has a valid PGP signatures</li>
                        <li>issued by trusted investigators</li>
                        <li>who has ACL access to a given module</li>
                    </ul></p>
                    <p>multiple signatures required to run sensitive modules</p>
                </section>

                <section>
                    <h2>Security of the platform: API</h2>
                    <p>REST API, uses <a href="https://github.com/jvehent/idfix">IdFix</a> PGP Token authentication</p>
                    <pre>
curl -H 'X-PGPAUTHORIZATION: 1;2015-05-28T15:04:05Z;111;owEBYQGe/pANAwAIAaP...'
https://api.mig.example.net/api/v1/</pre>
                    <p>PGP already needed to sign actions<br />Using it to auth on the API avoids needing another username/password/access key.</p>
                </section>


                <section>
                    <h2>Security of the platform: Database</h2>
                    <p>Typical PostgreSQL protections (TLS, credentials, GRANTs)</p>
                    <p>Minimalistic attack surface:
                    <ul>
                        <li>Investigator keys are not stored in DB</li>
                        <li>Results are in DB but never contain raw data, minimalize impact of leak</li>
                    </ul>
                    </p>
                </section>

                <section>
                    <h2>Security of the platform: Scheduler</h2>
                    <p>Somewhat complex code path to move messages around BUT:
                        <ul>
                            <li>No user interaction</li>
                            <li>No way to tamper with signatures</li>
                        </ul>
                    </p>
                    <p>If it breaks, we're sad, but it doesn't compromise systems across the infrastructure.</p>
                </section>

                <section>
                    <h2>Security of the platform: <img src="statics/rabbitmq_logo_strap.png" /></h2>
                    <p>Most exposed component (public).<br />Requires AMQP over TLS with client certs and credentials.<br />Tightly controlled RabbitMQ ACLs, but hard to write/audit.</p>
                </section>

                <section>
                    <h2>Complex investigations:<br />write JSON directly</h2>
                    <p>many samples at<br /><a href="https://github.com/mozilla/mig/tree/master/actions">https://github.com/mozilla/mig/tree/master/actions</a></p>
                    <p>Example: <a href="https://github.com/mozilla/mig/blob/master/actions/shellshock_iocs.json">Shellshock IOCs</a></p>
                </section>

                <section>
                    <h2>MIG as a security pipeline</h2>
                    <ul>
                        <li>Vulnerability scanning with <a href="https://github.com/mozilla/mozoval">mozilla/mozoval</a></li>
                        <li>Syscall auditing (auditd) with <a href="https://github.com/mozilla/audit-go">mozilla/audit-go</a></li>
                        <li>Log inspections (OSSEC style)</li>
                        <li>Network monitoring (distributed NSM) using GoPacket</li>
                   </ul>
                </section>
                    
                <section>
                    <h2>Questions?</h2>
                    <pre><span style="color: #00ff1e;">
## ##                                     _.---._     .---.
# # # /-\ ---||  |    /\         __...---' .---. '---'-.   '.
#   #|   | / ||  |   /--\    .-''__.--' _.'( | )'.  '.  '._ :
#   # \_/ ---| \_ \_/    \ .'__-'_ .--'' ._'---'_.-.  '.   '-'.
     ###                         ~ -._ -._''---. -.    '-._   '.
      # |\ |\    /---------|          ~ -.._ _ _ _ ..-_ '.  '-._''--.._
      # | \| \  / |- |__ | |                       -~ -._  '-.  -. '-._''--.._.--''.
     ###|  \  \/  ---__| | |                            ~ ~-.__     -._  '-.__   '. '.
          #####                                               ~~ ~---...__ _    ._ .' '.
          #      /\  --- /-\ |--|----                                    ~  ~--.....--~
          # ### /--\  | |   ||-\  //
          #####/    \ |  \_/ |  \//__
                    </span></pre>
                    <h3>http://mig.mozilla.org</h3>
                </section>
			</div>

		</div>

		<script src="lib/js/head.min.js"></script>
		<script src="js/reveal.js"></script>

		<script>

			// Full list of configuration options available at:
			// https://github.com/hakimel/reveal.js#configuration
			Reveal.initialize({
				controls: true,
				progress: true,
				history: true,
				center: true,

				transition: 'slide', // none/fade/slide/convex/concave/zoom

				// Optional reveal.js plugins
				dependencies: [
					{ src: 'lib/js/classList.js', condition: function() { return !document.body.classList; } },
					{ src: 'plugin/markdown/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
					{ src: 'plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
					{ src: 'plugin/highlight/highlight.js', async: true, condition: function() { return !!document.querySelector( 'pre code' ); }, callback: function() { hljs.initHighlightingOnLoad(); } },
					{ src: 'plugin/notes/notes.js', async: true }
				]
			});

		</script>

	</body>
</html>
